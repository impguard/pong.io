#!/bin/bash


bake_task build "Builds the game."
function build {
  docker build -f 'build/Dockerfile' -t 'pong:latest' .
}


bake_task build:prod "Builds the production game."
function build:prod {
  docker build -f 'build/Dockerfile.prod' -t 'pong:latest' .
  bake_echo_green "Built the server container!"
  docker run --rm \
    -v "$PWD/dist/client:/game/dist/client" \
    'pong:latest' yarn build:client:prod
  bake_echo_green "Built client files!"
}


bake_task compose "Runs docker compose."
function compose {
  docker-compose -f 'build/docker-compose.yml' "$@"
}


bake_task exec "Execs into the game server."
function exec {
  compose run server "$@"
}


bake_task yarn "Runs yarn in the container."
function yarn {
  compose run server yarn "$@"
}


bake_task run "Runs the game."
function run {
  compose up
}


bake_task run:prod "Runs the production game."
function run:prod {
  docker-compose -f 'build/docker-compose.prod.yml' up
}
